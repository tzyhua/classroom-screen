<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•™å®¤è¢å¹•ç³»çµ± v6.0 (é€²åº¦ç®¡ç†ç‰ˆ)</title>
    <style>
        /* --- 1. åŸºç¤è¨­å®š --- */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            overscroll-behavior: none; 
        }

        #bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1497561813398-8fcc7a37b567?q=80&w=1920&auto=format&fit=crop');
            background-size: cover; background-position: center; z-index: -1;
            transition: background-image 0.5s;
        }

        /* --- ç­ç´šåˆ‡æ›åˆ— --- */
        .class-bar {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px);
            padding: 8px 10px; border-radius: 50px; display: flex; gap: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); z-index: 200;
        }
        .class-btn {
            border: none; background: transparent; padding: 8px 16px; border-radius: 20px;
            font-size: 16px; font-weight: bold; color: #666; cursor: pointer; transition: all 0.2s;
        }
        .class-btn:hover { background: #eee; }
        .class-btn.active { background: #2196F3; color: white; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4); }

        /* --- åº•éƒ¨ Dock --- */
        .dock-container {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(12px);
            padding: 12px 24px; border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3); display: flex; gap: 15px;
            z-index: 100;
        }
        .dock-btn {
            width: 55px; height: 55px; border: none; background: white;
            border-radius: 14px; font-size: 26px; cursor: pointer; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s;
            user-select: none;
        }
        .dock-btn:active { transform: scale(0.9); }
        /* Tooltip */
        .dock-btn::after {
            content: attr(data-title); position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;
            opacity: 0; pointer-events: none; transition: opacity 0.2s; white-space: nowrap;
        }
        .dock-btn:hover::after { opacity: 1; }

        /* --- è¦–çª—é€šç”¨ --- */
        .widget-window {
            position: absolute; width: 340px; 
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            display: none; flex-direction: column; overflow: hidden;
            top: 100px; left: 50px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .window-header {
            background: #f8f9fa; padding: 15px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            user-select: none; border-bottom: 1px solid #eee; touch-action: none;
        }
        .window-title { font-weight: bold; font-size: 18px; color: #333; }
        .window-subtitle { font-size: 12px; color: #2196F3; margin-left: 8px; font-weight: normal; }
        .close-btn {
            width: 30px; height: 30px; background: #ff5f57; border-radius: 50%;
            color: white; text-align: center; line-height: 28px; font-weight: bold; cursor: pointer;
        }
        .window-content { padding: 15px; }

        /* --- å„åŠŸèƒ½æ¨£å¼ --- */
        
        /* 1. è¨ˆæ™‚å™¨ */
        .timer-tabs { display: flex; background: #eee; border-radius: 10px; padding: 4px; margin-bottom: 15px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #777; }
        .tab-btn.active { background: white; color: #2196F3; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .timer-display { font-size: 60px; font-weight: bold; text-align: center; color: #333; font-family: 'Courier New', monospace; margin: 10px 0; }
        .timer-display.red-alert { color: #ff5252; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .timer-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        .control-btn { width: 50px; height: 50px; border-radius: 50%; border: none; font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .btn-play { background: #4CAF50; color: white; } .btn-pause { background: #FFC107; color: white; } .btn-reset { background: #eee; color: #555; }
        .preset-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .preset-btn { border: 1px solid #ddd; background: white; padding: 8px; border-radius: 8px; cursor: pointer; font-size: 14px; }

        /* 2. å°çµ„åˆ†æ•¸ */
        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .score-card { background: #fff; border: 2px solid #eee; border-radius: 12px; padding: 10px; text-align: center; }
        .score-animal { font-size: 24px; display: block; }
        .score-value { font-size: 28px; font-weight: bold; color: #333; margin: 5px 0; }
        .score-actions button { width: 30px; height: 30px; border-radius: 50%; border: none; color: white; cursor: pointer; margin: 0 5px;}
        .btn-add { background: #4CAF50; } .btn-minus { background: #ff9800; }

        /* 3. ä½œæ¥­ç™»è¨˜ */
        .hw-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 15px; }
        .student-circle { width: 45px; height: 45px; border-radius: 50%; background: #f0f0f0; border: 2px solid #ddd; display: flex; justify-content: center; align-items: center; font-weight: bold; color: #666; cursor: pointer; }
        .status-done { background: #4CAF50; border-color: #388E3C; color: white; } .status-missing { background: #ff5252; border-color: #D32F2F; color: white; }
        .hw-summary { background: #eee; border-radius: 8px; padding: 10px; font-size: 14px; text-align: center; color: #555; }

        /* 4. ä¸Šèª²é€²åº¦ (NEW) */
        .memo-area {
            width: 100%; height: 200px; padding: 10px; box-sizing: border-box;
            border: 1px solid #ddd; border-radius: 10px; font-size: 16px; line-height: 1.5;
            resize: none; background: #fffdf0; /* æ¨¡æ“¬ä¾¿æ¢ç´™é¡è‰² */
            color: #333; outline: none;
        }
        .memo-area:focus { border-color: #FDD835; box-shadow: 0 0 0 2px rgba(253, 216, 53, 0.3); }

        /* 5. å¸¸ç”¨é€£çµ (NEW) */
        .link-input-group { display: flex; gap: 5px; margin-bottom: 10px; }
        .link-input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .btn-add-link { background: #2196F3; color: white; border: none; border-radius: 8px; padding: 0 12px; cursor: pointer; }
        .link-list { max-height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .link-item { display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; padding: 8px 12px; border-radius: 8px; }
        .link-item a { text-decoration: none; color: #333; font-weight: bold; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .link-item a:hover { color: #2196F3; }
        .btn-del-link { background: none; border: none; color: #999; cursor: pointer; font-size: 16px; padding: 0 5px; }
        .btn-del-link:hover { color: red; }

    </style>
</head>
<body>

    <div id="bg-layer"></div>

    <div class="class-bar">
        <button class="class-btn active" onclick="switchClass(1)">1 ç­</button>
        <button class="class-btn" onclick="switchClass(2)">2 ç­</button>
        <button class="class-btn" onclick="switchClass(3)">3 ç­</button>
        <button class="class-btn" onclick="switchClass(4)">4 ç­</button>
        <button class="class-btn" onclick="switchClass(5)">5 ç­</button>
        <button class="class-btn" onclick="switchClass(6)">6 ç­</button>
    </div>

    <div class="dock-container">
        <button class="dock-btn" data-title="è¨ˆæ™‚å™¨" onclick="toggleWidget('widget-timer')">â³</button>
        <button class="dock-btn" data-title="å°çµ„åˆ†æ•¸" onclick="toggleWidget('widget-scores')">ğŸ†</button>
        <button class="dock-btn" data-title="ä½œæ¥­ç™»è¨˜" onclick="toggleWidget('widget-homework')">ğŸ“‹</button>
        <button class="dock-btn" data-title="ä¸Šèª²é€²åº¦" onclick="toggleWidget('widget-memo')">ğŸ“–</button>
        <button class="dock-btn" data-title="å¸¸ç”¨é€£çµ" onclick="toggleWidget('widget-links')">ğŸ”—</button>
    </div>

    <div id="widget-timer" class="widget-window" style="left: 30px; top: 80px;">
        <div class="window-header"><span class="window-title">è¨ˆæ™‚å™¨</span><span class="close-btn" onclick="toggleWidget('widget-timer')">Ã—</span></div>
        <div class="window-content">
            <div class="timer-tabs"><button class="tab-btn active" onclick="switchTimerMode('countdown')">å€’æ•¸</button><button class="tab-btn" onclick="switchTimerMode('stopwatch')">æ­£æ•¸</button></div>
            <div class="timer-display" id="timer-text">05:00</div>
            <div class="timer-controls"><button class="control-btn btn-reset" onclick="resetTimer()">â†º</button><button class="control-btn btn-play" id="play-btn" onclick="toggleTimer()">â–¶</button></div>
            <div class="preset-btns" id="preset-area"><button class="preset-btn" onclick="addTime(10)">+10ç§’</button><button class="preset-btn" onclick="addTime(60)">+1åˆ†</button><button class="preset-btn" onclick="addTime(300)">+5åˆ†</button></div>
        </div>
    </div>

    <div id="widget-scores" class="widget-window" style="left: 400px; top: 80px;">
        <div class="window-header"><div><span class="window-title">å°çµ„ç«¶è³½</span><span class="window-subtitle" id="sub-score">1 ç­</span></div><span class="close-btn" onclick="toggleWidget('widget-scores')">Ã—</span></div>
        <div class="window-content"><div class="score-grid" id="score-grid"></div><div style="text-align:center;margin-top:10px;"><button onclick="resetScores()" style="border:none;background:none;color:#999;text-decoration:underline;cursor:pointer;">æœ¬ç­æ­¸é›¶</button></div></div>
    </div>

    <div id="widget-homework" class="widget-window" style="left: 30px; top: 450px;">
        <div class="window-header"><div><span class="window-title">ä½œæ¥­ç™»è¨˜</span><span class="window-subtitle" id="sub-hw">1 ç­</span></div><span class="close-btn" onclick="toggleWidget('widget-homework')">Ã—</span></div>
        <div class="window-content"><div class="hw-grid" id="hw-grid"></div><div class="hw-summary" id="hw-summary"></div><div style="text-align:center;margin-top:10px;"><button onclick="resetHomework()" style="border:none;background:none;color:#999;text-decoration:underline;cursor:pointer;">æœ¬ç­é‡ç½®</button></div></div>
    </div>

    <div id="widget-memo" class="widget-window" style="left: 400px; top: 450px;">
        <div class="window-header"><div><span class="window-title">ä¸Šèª²é€²åº¦</span><span class="window-subtitle" id="sub-memo">1 ç­</span></div><span class="close-btn" onclick="toggleWidget('widget-memo')">Ã—</span></div>
        <div class="window-content">
            <textarea id="memo-text" class="memo-area" placeholder="åœ¨æ­¤è¼¸å…¥é€²åº¦ï¼ˆä¾‹å¦‚ï¼šèª²æœ¬ P.32ï¼Œä¸‹æ¬¡è¦è€ƒå–®å­—...ï¼‰" oninput="saveMemo()"></textarea>
        </div>
    </div>

    <div id="widget-links" class="widget-window" style="left: 770px; top: 80px;">
        <div class="window-header"><span class="window-title">å¸¸ç”¨é€£çµ</span><span class="close-btn" onclick="toggleWidget('widget-links')">Ã—</span></div>
        <div class="window-content">
            <div class="link-input-group">
                <input type="text" id="link-title" class="link-input" placeholder="åç¨± (å¦‚: Kahoot)">
                <input type="text" id="link-url" class="link-input" placeholder="ç¶²å€ (https://...)">
                <button class="btn-add-link" onclick="addLink()">+</button>
            </div>
            <div class="link-list" id="link-list">
                </div>
            <div style="text-align:center;margin-top:5px;font-size:12px;color:#aaa;">æ­¤æ¸…å–®æ‰€æœ‰ç­ç´šå…±ç”¨</div>
        </div>
    </div>

    <script>
        // ==========================
        //  ç³»çµ±æ ¸å¿ƒ (System Core)
        // ==========================
        let currentClass = parseInt(localStorage.getItem('currentActiveIdx')) || 1;
        const STUDENT_COUNT = 30;

        // åˆå§‹åŒ–
        updateClassUI();
        loadAllData();
        renderLinks(); // é€£çµæ˜¯å…±ç”¨çš„ï¼Œåˆ†é–‹è®€å–

        function switchClass(idx) {
            currentClass = idx;
            localStorage.setItem('currentActiveIdx', currentClass);
            updateClassUI();
            loadAllData(); // é‡æ–°è®€å–è©²ç­è³‡æ–™
        }

        function updateClassUI() {
            document.querySelectorAll('.class-btn').forEach((btn, i) => btn.classList.toggle('active', i+1 === currentClass));
            ['sub-score', 'sub-hw', 'sub-memo'].forEach(id => document.getElementById(id).innerText = `${currentClass} ç­`);
        }

        function loadAllData() {
            renderScores();
            renderHomework();
            renderMemo();
        }

        // ==========================
        //  1. ä¸Šèª²é€²åº¦ (Memo) â˜… NEW
        // ==========================
        function renderMemo() {
            const key = `class_${currentClass}_memo`;
            const text = localStorage.getItem(key) || '';
            document.getElementById('memo-text').value = text;
        }

        function saveMemo() {
            const key = `class_${currentClass}_memo`;
            const text = document.getElementById('memo-text').value;
            localStorage.setItem(key, text);
        }

        // ==========================
        //  2. å¸¸ç”¨é€£çµ (Links) â˜… NEW
        // ==========================
        // é€£çµè¨­ç‚º Global (æ‰€æœ‰ç­ç´šå…±ç”¨)ï¼Œè‹¥è¦åˆ†ç­ç´šå­˜ï¼Œå°‡ key åŠ ä¸Š currentClass å³å¯
        let linksData = JSON.parse(localStorage.getItem('global_links')) || [];

        function renderLinks() {
            const list = document.getElementById('link-list');
            list.innerHTML = '';
            linksData.forEach((item, index) => {
                list.innerHTML += `
                    <div class="link-item">
                        <a href="${item.url}" target="_blank">ğŸ”— ${item.title}</a>
                        <button class="btn-del-link" onclick="deleteLink(${index})">Ã—</button>
                    </div>`;
            });
        }

        function addLink() {
            const titleInput = document.getElementById('link-title');
            const urlInput = document.getElementById('link-url');
            let title = titleInput.value.trim();
            let url = urlInput.value.trim();

            if(!title || !url) return alert('è«‹è¼¸å…¥åç¨±å’Œç¶²å€');
            if(!url.startsWith('http')) url = 'https://' + url; // è‡ªå‹•è£œä¸Š https

            linksData.push({ title, url });
            localStorage.setItem('global_links', JSON.stringify(linksData));
            
            titleInput.value = ''; urlInput.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
            renderLinks();
        }

        function deleteLink(index) {
            if(confirm('ç¢ºå®šåˆªé™¤æ­¤é€£çµï¼Ÿ')) {
                linksData.splice(index, 1);
                localStorage.setItem('global_links', JSON.stringify(linksData));
                renderLinks();
            }
        }

        // ==========================
        //  3. å°çµ„åˆ†æ•¸ (Scores)
        // ==========================
        const defaultScores = [{ icon: 'ğŸ¦', score: 0 }, { icon: 'ğŸ°', score: 0 }, { icon: 'ğŸ¼', score: 0 }, { icon: 'ğŸ¦Š', score: 0 }];
        function getScoreData() { return JSON.parse(localStorage.getItem(`class_${currentClass}_scores`)) || JSON.parse(JSON.stringify(defaultScores)); }
        function saveScoreData(d) { localStorage.setItem(`class_${currentClass}_scores`, JSON.stringify(d)); }
        function renderScores() {
            const grid = document.getElementById('score-grid'); grid.innerHTML = '';
            getScoreData().forEach((g, i) => grid.innerHTML += `<div class="score-card"><span class="score-animal">${g.icon}</span><div class="score-value">${g.score}</div><div class="score-actions"><button class="btn-minus" onclick="updateScore(${i}, -1)">-</button><button class="btn-add" onclick="updateScore(${i}, 1)">+</button></div></div>`);
        }
        function updateScore(i, v) { let d = getScoreData(); d[i].score = Math.max(0, d[i].score + v); saveScoreData(d); renderScores(); }
        function resetScores() { if(confirm(`æ­¸é›¶ ${currentClass} ç­åˆ†æ•¸ï¼Ÿ`)) { saveScoreData(JSON.parse(JSON.stringify(defaultScores))); renderScores(); }}

        // ==========================
        //  4. ä½œæ¥­ç™»è¨˜ (Homework)
        // ==========================
        function getHWData() { return JSON.parse(localStorage.getItem(`class_${currentClass}_homework`)) || new Array(STUDENT_COUNT).fill(0); }
        function saveHWData(d) { localStorage.setItem(`class_${currentClass}_homework`, JSON.stringify(d)); }
        function renderHomework() {
            const grid = document.getElementById('hw-grid'); grid.innerHTML = ''; let done=0, miss=0;
            getHWData().forEach((s, i) => {
                let c = s===1 ? 'status-done' : (s===2 ? 'status-missing' : '');
                if(s===1) done++; if(s===2) miss++;
                grid.innerHTML += `<div class="student-circle ${c}" onclick="toggleHW(${i})">${i+1}</div>`;
            });
            document.getElementById('hw-summary').innerHTML = `${currentClass}ç­: å·²äº¤ <b>${done}</b> | <span style="color:red">ç¼ºäº¤ <b>${miss}</b></span>`;
        }
        function toggleHW(i) { let d = getHWData(); d[i] = (d[i]+1)%3; saveHWData(d); renderHomework(); }
        function resetHomework() { if(confirm(`é‡ç½® ${currentClass} ç­ä½œæ¥­ï¼Ÿ`)) { saveHWData(new Array(STUDENT_COUNT).fill(0)); renderHomework(); }}

        // ==========================
        //  5. è¨ˆæ™‚å™¨ (Timer)
        // ==========================
        let tMode = 'countdown', tRem = 300, tStop = 0, tInt = null, isRun = false;
        function switchTimerMode(m) {
            tMode = m; isRun = false; clearInterval(tInt);
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active');
            document.getElementById('play-btn').innerText = 'â–¶'; document.getElementById('play-btn').className = 'control-btn btn-play'; document.getElementById('timer-text').classList.remove('red-alert');
            document.getElementById('preset-area').style.display = m==='countdown'?'grid':'none';
            updateTimeDisplay(m==='countdown'?tRem:tStop);
        }
        function updateTimeDisplay(s) { document.getElementById('timer-text').innerText = `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
        function toggleTimer() {
            const btn = document.getElementById('play-btn');
            if(isRun) { clearInterval(tInt); isRun=false; btn.innerText='â–¶'; btn.className='control-btn btn-play'; }
            else {
                isRun=true; btn.innerText='â¸'; btn.className='control-btn btn-pause';
                tInt = setInterval(() => {
                    if(tMode==='countdown') { if(tRem>0) { tRem--; updateTimeDisplay(tRem); } else { timeUp(); } }
                    else { tStop++; updateTimeDisplay(tStop); }
                }, 1000);
            }
        }
        function resetTimer() { clearInterval(tInt); isRun=false; document.getElementById('play-btn').innerText='â–¶'; document.getElementById('play-btn').className='control-btn btn-play'; document.getElementById('timer-text').classList.remove('red-alert'); if(tMode==='countdown') { tRem=300; updateTimeDisplay(tRem); } else { tStop=0; updateTimeDisplay(0); } }
        function addTime(s) { if(tMode==='countdown') { tRem+=s; updateTimeDisplay(tRem); } }
        function timeUp() { clearInterval(tInt); isRun=false; document.getElementById('play-btn').innerText='â–¶'; document.getElementById('play-btn').className='control-btn btn-play'; document.getElementById('timer-text').classList.add('red-alert'); playBeep(); }
        function playBeep() {
            const A = window.AudioContext || window.webkitAudioContext; if(!A) return; const c = new A(), o = c.createOscillator(), g = c.createGain();
            o.type='sine'; o.frequency.setValueAtTime(880, c.currentTime); g.gain.setValueAtTime(0.5, c.currentTime); g.gain.exponentialRampToValueAtTime(0.01, c.currentTime+0.5);
            o.connect(g); g.connect(c.destination); o.start(); o.stop(c.currentTime+0.5);
        }

        // ==========================
        //  è¦–çª—æ‹–æ›³ (Draggable)
        // ==========================
        let zC = 100;
        document.querySelectorAll('.widget-window').forEach(el => {
            const h = el.querySelector('.window-header'); let isD=false, sX, sY, iL, iT;
            const start = (e) => { el.style.zIndex = ++zC; const t = e.touches?e.touches[0]:e; isD=true; sX=t.clientX; sY=t.clientY; iL=el.offsetLeft; iT=el.offsetTop; };
            const move = (e) => { if(!isD)return; e.preventDefault(); const t = e.touches?e.touches[0]:e; el.style.left = `${iL+(t.clientX-sX)}px`; el.style.top = `${iT+(t.clientY-sY)}px`; };
            const end = () => isD=false;
            h.addEventListener("mousedown", start); h.addEventListener("touchstart", start, {passive:false});
            document.addEventListener("mousemove", move); document.addEventListener("touchmove", move, {passive:false});
            document.addEventListener("mouseup", end); document.addEventListener("touchend", end);
        });
        function toggleWidget(id) { const el = document.getElementById(id); if(el.style.display==='flex') el.style.display='none'; else { el.style.display='flex'; el.style.zIndex=++zC; } }
    </script>
</body>
</html>
