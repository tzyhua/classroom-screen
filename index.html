<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•™å®¤è¢å¹•ç³»çµ± v7.0 (å®¢è£½åŒ–ç‰ˆ)</title>
    <style>
        /* --- 1. åŸºç¤è¨­å®š --- */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; overscroll-behavior: none; }
        
        #bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1497561813398-8fcc7a37b567?q=80&w=1920&auto=format&fit=crop');
            background-size: cover; background-position: center; z-index: -1; transition: background-image 0.5s;
        }

        /* --- 2. ç­ç´šåˆ‡æ›åˆ— (å¯æ²å‹•) --- */
        .top-bar-container {
            position: fixed; top: 20px; left: 0; width: 100%; z-index: 200;
            display: flex; justify-content: center; align-items: center; pointer-events: none; /* è®“åº•ä¸‹ä¹Ÿèƒ½é» */
        }
        .class-bar {
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px);
            padding: 8px 15px; border-radius: 50px; display: flex; gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); pointer-events: auto;
            max-width: 90%; overflow-x: auto; white-space: nowrap; /* æ”¯æ´å¤šç­ç´šæ©«å‘æ²å‹• */
        }
        /* éš±è—æ²è»¸ */
        .class-bar::-webkit-scrollbar { display: none; }

        .class-btn {
            border: none; background: transparent; padding: 8px 16px; border-radius: 20px;
            font-size: 16px; font-weight: bold; color: #666; cursor: pointer; transition: all 0.2s;
            flex-shrink: 0;
        }
        .class-btn:hover { background: #eee; }
        .class-btn.active { background: #2196F3; color: white; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4); }
        
        .settings-btn {
            border: none; background: #eee; width: 36px; height: 36px; border-radius: 50%;
            cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 18px; color: #555;
            flex-shrink: 0; margin-left: 5px;
        }
        .settings-btn:hover { background: #ddd; transform: rotate(90deg); transition: transform 0.3s; }

        /* --- 3. åº•éƒ¨ Dock --- */
        .dock-container {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(12px);
            padding: 12px 24px; border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3); display: flex; gap: 15px;
            z-index: 100;
        }
        .dock-btn {
            width: 55px; height: 55px; border: none; background: white;
            border-radius: 14px; font-size: 26px; cursor: pointer; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s; user-select: none;
        }
        .dock-btn:active { transform: scale(0.9); }
        .dock-btn:hover::after {
            content: attr(data-title); position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; pointer-events: none;
        }

        /* --- 4. è¦–çª—é€šç”¨ --- */
        .widget-window {
            position: absolute; width: 340px; background: rgba(255, 255, 255, 0.98);
            border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            display: none; flex-direction: column; overflow: hidden;
            top: 100px; left: 50px; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .window-header {
            background: #f8f9fa; padding: 15px; cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            user-select: none; border-bottom: 1px solid #eee; touch-action: none;
        }
        .window-title { font-weight: bold; font-size: 18px; color: #333; }
        .window-subtitle { font-size: 12px; color: #2196F3; margin-left: 8px; font-weight: normal; }
        .close-btn { width: 30px; height: 30px; background: #ff5f57; border-radius: 50%; color: white; text-align: center; line-height: 28px; font-weight: bold; cursor: pointer; }
        .window-content { padding: 15px; max-height: 400px; overflow-y: auto; }

        /* --- åŠŸèƒ½ç‰¹å®šæ¨£å¼ --- */
        /* è¨ˆæ™‚å™¨ */
        .timer-display { font-size: 60px; font-weight: bold; text-align: center; color: #333; font-family: monospace; margin: 10px 0; }
        .timer-display.red-alert { color: #ff5252; animation: blink 1s infinite; } @keyframes blink { 50% { opacity: 0.5; } }
        .timer-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        .control-btn { width: 50px; height: 50px; border-radius: 50%; border: none; font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .btn-play { background: #4CAF50; color: white; } .btn-pause { background: #FFC107; color: white; } .btn-reset { background: #eee; color: #555; }
        .preset-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .preset-btn { border: 1px solid #ddd; background: white; padding: 8px; border-radius: 8px; cursor: pointer; }
        .timer-tabs { display: flex; background: #eee; border-radius: 10px; padding: 4px; margin-bottom: 15px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #777; }
        .tab-btn.active { background: white; color: #2196F3; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* å°çµ„ & ä½œæ¥­ */
        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .score-card { background: #fff; border: 2px solid #eee; border-radius: 12px; padding: 10px; text-align: center; }
        .score-value { font-size: 28px; font-weight: bold; margin: 5px 0; }
        .score-actions button { width: 30px; height: 30px; border-radius: 50%; border: none; color: white; cursor: pointer; margin: 0 5px;}
        .btn-add { background: #4CAF50; } .btn-minus { background: #ff9800; }
        
        /* é€£çµ & å‚™å¿˜ */
        .memo-area { width: 100%; height: 150px; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 10px; resize: none; background: #fffdf0; outline: none; }
        .link-item { display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; padding: 8px 12px; border-radius: 8px; margin-bottom: 8px;}
        .link-item a { text-decoration: none; color: #333; font-weight: bold; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .btn-del-link { background: none; border: none; color: #999; cursor: pointer; font-size: 16px; }

        /* --- NEW: å€‹äººåŠ åˆ†è¡¨å–® (Individual Scores) --- */
        .ind-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .ind-card {
            background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 5px;
            display: flex; flex-direction: column; align-items: center; position: relative;
            user-select: none;
        }
        .ind-num { font-size: 12px; color: #777; font-weight: bold; margin-bottom: 2px;}
        .ind-score { font-size: 20px; font-weight: bold; color: #2196F3; cursor: pointer; }
        .ind-score:active { transform: scale(1.2); }
        .ind-ctrl { display: flex; gap: 5px; margin-top: 5px; width: 100%; justify-content: center;}
        .ind-btn { width: 20px; height: 20px; border-radius: 4px; border: none; color: white; font-size: 14px; cursor: pointer; padding: 0; display:flex; justify-content:center; align-items:center;}
        .ind-btn-minus { background: #ff9800; }
        .ind-btn-add { background: #4CAF50; width: 100%; height: 25px; font-size: 16px;}

        /* --- NEW: ç­ç´šè¨­å®šå½ˆçª— --- */
        .settings-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 500; display: none;
            justify-content: center; align-items: center;
        }
        .settings-box {
            background: white; padding: 20px; border-radius: 15px; width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .class-list-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; align-items: center; }
        .class-list-item input { border: 1px solid #ddd; padding: 5px; border-radius: 4px; width: 120px; }
        .btn-del-class { color: red; cursor: pointer; border: none; background: none; font-weight: bold; }
        .btn-new-class { width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 8px; margin-top: 10px; cursor: pointer; }

    </style>
</head>
<body>

    <div id="bg-layer"></div>

    <div class="top-bar-container">
        <div class="class-bar" id="top-class-bar">
            </div>
        <button class="settings-btn" onclick="openSettings()">âš™ï¸</button>
    </div>

    <div class="dock-container">
        <button class="dock-btn" data-title="è¨ˆæ™‚å™¨" onclick="toggleWidget('widget-timer')">â³</button>
        <button class="dock-btn" data-title="å°çµ„åˆ†æ•¸" onclick="toggleWidget('widget-scores')">ğŸ†</button>
        <button class="dock-btn" data-title="å€‹äººåŠ åˆ†" onclick="toggleWidget('widget-individual')">ğŸ§‘â€ğŸ“</button>
        <button class="dock-btn" data-title="ä½œæ¥­ç™»è¨˜" onclick="toggleWidget('widget-homework')">ğŸ“‹</button>
        <button class="dock-btn" data-title="ä¸Šèª²é€²åº¦" onclick="toggleWidget('widget-memo')">ğŸ“–</button>
        <button class="dock-btn" data-title="å¸¸ç”¨é€£çµ" onclick="toggleWidget('widget-links')">ğŸ”—</button>
    </div>

    <div id="widget-timer" class="widget-window" style="left: 30px; top: 80px;">
        <div class="window-header"><span class="window-title">è¨ˆæ™‚å™¨</span><span class="close-btn" onclick="toggleWidget('widget-timer')">Ã—</span></div>
        <div class="window-content">
            <div class="timer-tabs"><button class="tab-btn active" onclick="switchTimerMode('countdown')">å€’æ•¸</button><button class="tab-btn" onclick="switchTimerMode('stopwatch')">æ­£æ•¸</button></div>
            <div class="timer-display" id="timer-text">05:00</div>
            <div class="timer-controls"><button class="control-btn btn-reset" onclick="resetTimer()">â†º</button><button class="control-btn btn-play" id="play-btn" onclick="toggleTimer()">â–¶</button></div>
            <div class="preset-btns" id="preset-area"><button class="preset-btn" onclick="addTime(10)">+10ç§’</button><button class="preset-btn" onclick="addTime(60)">+1åˆ†</button><button class="preset-btn" onclick="addTime(300)">+5åˆ†</button></div>
        </div>
    </div>

    <div id="widget-scores" class="widget-window" style="left: 400px; top: 80px;">
        <div class="window-header"><div><span class="window-title">å°çµ„ç«¶è³½</span><span class="window-subtitle sub-cls"></span></div><span class="close-btn" onclick="toggleWidget('widget-scores')">Ã—</span></div>
        <div class="window-content"><div class="score-grid" id="score-grid"></div><div style="text-align:center;margin-top:10px;"><button onclick="resetScores()" style="border:none;background:none;color:#999;text-decoration:underline;cursor:pointer;">æœ¬ç­æ­¸é›¶</button></div></div>
    </div>

    <div id="widget-individual" class="widget-window" style="left: 770px; top: 80px; width: 400px;">
        <div class="window-header"><div><span class="window-title">å€‹äººåŠ åˆ†è¡¨</span><span class="window-subtitle sub-cls"></span></div><span class="close-btn" onclick="toggleWidget('widget-individual')">Ã—</span></div>
        <div class="window-content">
            <div class="ind-grid" id="ind-grid"></div>
            <div style="text-align:center;margin-top:15px; font-size:12px; color:#888;">
                æç¤ºï¼šé»æ“Šç¶ è‰²æ¢åŠ åˆ†ï¼Œé»æ“Šæ©˜è‰²éˆ•æ‰£åˆ†
            </div>
             <div style="text-align:center;margin-top:5px;"><button onclick="resetIndividual()" style="border:none;background:none;color:#999;text-decoration:underline;cursor:pointer;">æœ¬ç­å…¨éƒ¨æ­¸é›¶</button></div>
        </div>
    </div>

    <div id="widget-homework" class="widget-window" style="left: 30px; top: 450px;">
        <div class="window-header"><div><span class="window-title">ä½œæ¥­ç™»è¨˜</span><span class="window-subtitle sub-cls"></span></div><span class="close-btn" onclick="toggleWidget('widget-homework')">Ã—</span></div>
        <div class="window-content"><div class="ind-grid" id="hw-grid"></div><div class="hw-summary" id="hw-summary" style="margin-top:10px;"></div><div style="text-align:center;margin-top:10px;"><button onclick="resetHomework()" style="border:none;background:none;color:#999;text-decoration:underline;cursor:pointer;">æœ¬ç­é‡ç½®</button></div></div>
    </div>

    <div id="widget-memo" class="widget-window" style="left: 400px; top: 450px;">
        <div class="window-header"><div><span class="window-title">ä¸Šèª²é€²åº¦</span><span class="window-subtitle sub-cls"></span></div><span class="close-btn" onclick="toggleWidget('widget-memo')">Ã—</span></div>
        <div class="window-content"><textarea id="memo-text" class="memo-area" placeholder="è¼¸å…¥é€²åº¦..." oninput="saveMemo()"></textarea></div>
    </div>

    <div id="widget-links" class="widget-window" style="left: 770px; top: 450px;">
        <div class="window-header"><span class="window-title">å¸¸ç”¨é€£çµ</span><span class="close-btn" onclick="toggleWidget('widget-links')">Ã—</span></div>
        <div class="window-content">
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="text" id="link-title" placeholder="åç¨±" style="flex:1; padding:5px;">
                <input type="text" id="link-url" placeholder="ç¶²å€" style="flex:1; padding:5px;">
                <button onclick="addLink()" style="background:#2196F3; color:white; border:none; border-radius:4px;">+</button>
            </div>
            <div id="link-list" style="max-height:250px; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="settings-modal" class="settings-overlay">
        <div class="settings-box">
            <h3 style="margin-top:0;">ç­ç´šç®¡ç†</h3>
            <div id="class-list-edit" style="max-height:300px; overflow-y:auto;"></div>
            <button class="btn-new-class" onclick="addNewClass()">+ æ–°å¢ç­ç´š</button>
            <button onclick="closeSettings()" style="width:100%; padding:10px; background:#ddd; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">é—œé–‰</button>
        </div>
    </div>

    <script>
        // ==========================
        //  1. ç­ç´šç®¡ç†ç³»çµ± (Dynamic Class System)
        // ==========================
        // é è¨­è³‡æ–™
        const defaultClasses = [
            { id: 'c1', name: '1 ç­' }, { id: 'c2', name: '2 ç­' }, { id: 'c3', name: '3 ç­' }
        ];
        
        // è®€å–ç­ç´šè¨­å®š
        let classes = JSON.parse(localStorage.getItem('class_config')) || defaultClasses;
        let currentClassId = localStorage.getItem('current_class_id') || classes[0].id;
        
        // å¦‚æœç›®å‰ç´€éŒ„çš„ classId å·²ç¶“è¢«åˆªé™¤äº†ï¼Œå°±å›åˆ°ç¬¬ä¸€å€‹
        if(!classes.find(c => c.id === currentClassId)) {
            currentClassId = classes[0] ? classes[0].id : null;
        }

        function init() {
            renderClassBar();
            loadAllData();
            renderLinks();
            // æ›´æ–°è¦–çª—æ¨™é¡Œçš„ç­ç´šåç¨±
            updateSubtitles();
        }

        function renderClassBar() {
            const bar = document.getElementById('top-class-bar');
            bar.innerHTML = '';
            classes.forEach(cls => {
                const btn = document.createElement('button');
                btn.className = `class-btn ${cls.id === currentClassId ? 'active' : ''}`;
                btn.innerText = cls.name;
                btn.onclick = () => switchClass(cls.id);
                bar.appendChild(btn);
            });
        }

        function switchClass(id) {
            currentClassId = id;
            localStorage.setItem('current_class_id', id);
            renderClassBar();
            loadAllData();
            updateSubtitles();
        }

        function updateSubtitles() {
            const currentName = classes.find(c => c.id === currentClassId)?.name || '';
            document.querySelectorAll('.sub-cls').forEach(el => el.innerText = currentName);
        }

        // --- è¨­å®šå½ˆçª—é‚è¼¯ ---
        function openSettings() {
            const list = document.getElementById('class-list-edit');
            list.innerHTML = '';
            classes.forEach((cls, index) => {
                list.innerHTML += `
                    <div class="class-list-item">
                        <input type="text" value="${cls.name}" onchange="updateClassName('${cls.id}', this.value)">
                        ${classes.length > 1 ? `<button class="btn-del-class" onclick="deleteClass('${cls.id}')">åˆªé™¤</button>` : ''}
                    </div>
                `;
            });
            document.getElementById('settings-modal').style.display = 'flex';
        }

        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; renderClassBar(); updateSubtitles(); }

        function addNewClass() {
            const newId = 'c' + Date.now();
            classes.push({ id: newId, name: 'æ–°ç­ç´š' });
            localStorage.setItem('class_config', JSON.stringify(classes));
            openSettings(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨
        }

        function updateClassName(id, newName) {
            const cls = classes.find(c => c.id === id);
            if(cls) { cls.name = newName; localStorage.setItem('class_config', JSON.stringify(classes)); }
        }

        function deleteClass(id) {
            if(confirm('ç¢ºå®šåˆªé™¤æ­¤ç­ç´šï¼Ÿæ‰€æœ‰è³‡æ–™å°‡æ¶ˆå¤±ï¼')) {
                classes = classes.filter(c => c.id !== id);
                localStorage.setItem('class_config', JSON.stringify(classes));
                // å¦‚æœåˆªæ‰çš„æ˜¯ç•¶å‰ç­ç´šï¼Œåˆ‡æ›åˆ°ç¬¬ä¸€å€‹
                if(id === currentClassId) { switchClass(classes[0].id); }
                openSettings();
            }
        }

        // ==========================
        //  2. å€‹äººåŠ åˆ†ç³»çµ± (Individual Scores) â˜… NEW
        // ==========================
        const STUDENT_COUNT = 35; // é è¨­ 35 äºº
        function getIndData() { return JSON.parse(localStorage.getItem(`${currentClassId}_ind_scores`)) || new Array(STUDENT_COUNT).fill(0); }
        function saveIndData(d) { localStorage.setItem(`${currentClassId}_ind_scores`, JSON.stringify(d)); }

        function renderIndividual() {
            const grid = document.getElementById('ind-grid');
            grid.innerHTML = '';
            const data = getIndData();
            data.forEach((score, i) => {
                grid.innerHTML += `
                    <div class="ind-card">
                        <span class="ind-num">${i+1}</span>
                        <div class="ind-score">${score}</div>
                        <div class="ind-ctrl">
                            <button class="ind-btn ind-btn-minus" onclick="modIndScore(${i}, -1)">-</button>
                            <button class="ind-btn ind-btn-add" onclick="modIndScore(${i}, 1)">+</button>
                        </div>
                    </div>`;
            });
        }

        function modIndScore(idx, val) {
            let data = getIndData();
            data[idx] += val;
            saveIndData(data);
            renderIndividual();
        }

        function resetIndividual() {
            if(confirm('ç¢ºå®šæ­¸é›¶å…¨ç­å€‹äººåˆ†æ•¸ï¼Ÿ')) {
                saveIndData(new Array(STUDENT_COUNT).fill(0));
                renderIndividual();
            }
        }

        // ==========================
        //  3. å…¶ä»–åŠŸèƒ½ (Scores, Homework, Memo, Links)
        // ==========================
        function loadAllData() {
            renderScores();
            renderIndividual();
            renderHomework();
            renderMemo();
        }

        // å°çµ„
        const defaultGroup = [{icon:'ğŸ¦',s:0},{icon:'ğŸ°',s:0},{icon:'ğŸ¼',s:0},{icon:'ğŸ¦Š',s:0},{icon:'ğŸ¯',s:0},{icon:'ğŸ¸',s:0}];
        function renderScores() {
            const d = JSON.parse(localStorage.getItem(`${currentClassId}_scores`)) || defaultGroup;
            const g = document.getElementById('score-grid'); g.innerHTML='';
            d.forEach((x,i)=> g.innerHTML+=`<div class="score-card"><span style="font-size:24px">${x.icon}</span><div class="score-value">${x.s}</div><div><button class="btn-minus" onclick="modScore(${i},-1)">-</button><button class="btn-add" onclick="modScore(${i},1)">+</button></div></div>`);
        }
        function modScore(i,v) { 
            let d = JSON.parse(localStorage.getItem(`${currentClassId}_scores`)) || defaultGroup;
            d[i].s = Math.max(0, d[i].s+v); localStorage.setItem(`${currentClassId}_scores`, JSON.stringify(d)); renderScores();
        }
        function resetScores() { localStorage.removeItem(`${currentClassId}_scores`); renderScores(); }

        // ä½œæ¥­
        function renderHomework() {
            const d = JSON.parse(localStorage.getItem(`${currentClassId}_hw`)) || new Array(STUDENT_COUNT).fill(0);
            const g = document.getElementById('hw-grid'); g.innerHTML=''; let done=0,miss=0;
            d.forEach((s,i)=>{
                let color = s===0?'#f0f0f0':(s===1?'#4CAF50':'#ff5252');
                let tColor = s===0?'#666':'white';
                g.innerHTML+=`<div style="background:${color};color:${tColor};width:100%;height:40px;border-radius:5px;display:flex;justify-content:center;align-items:center;font-weight:bold;cursor:pointer;border:1px solid #ddd;" onclick="toggleHw(${i})">${i+1}</div>`;
                if(s===1)done++;if(s===2)miss++;
            });
            document.getElementById('hw-summary').innerHTML = `å·²äº¤: <b>${done}</b> | ç¼ºäº¤: <b style="color:red">${miss}</b>`;
        }
        function toggleHw(i){ let d=JSON.parse(localStorage.getItem(`${currentClassId}_hw`))||new Array(STUDENT_COUNT).fill(0); d[i]=(d[i]+1)%3; localStorage.setItem(`${currentClassId}_hw`, JSON.stringify(d)); renderHomework(); }
        function resetHomework(){ if(confirm('é‡ç½®ä½œæ¥­ï¼Ÿ')){localStorage.removeItem(`${currentClassId}_hw`); renderHomework();} }

        // å‚™å¿˜
        function renderMemo() { document.getElementById('memo-text').value = localStorage.getItem(`${currentClassId}_memo`) || ''; }
        function saveMemo() { localStorage.setItem(`${currentClassId}_memo`, document.getElementById('memo-text').value); }

        // é€£çµ (å…±ç”¨)
        let links = JSON.parse(localStorage.getItem('shared_links')) || [];
        function renderLinks() {
            const l = document.getElementById('link-list'); l.innerHTML='';
            links.forEach((x,i)=> l.innerHTML+=`<div class="link-item"><a href="${x.url}" target="_blank">ğŸ”— ${x.title}</a><button class="btn-del-link" onclick="delLink(${i})">Ã—</button></div>`);
        }
        function addLink() {
            let t = document.getElementById('link-title').value, u = document.getElementById('link-url').value;
            if(t&&u) { if(!u.startsWith('http'))u='https://'+u; links.push({title:t,url:u}); localStorage.setItem('shared_links', JSON.stringify(links)); renderLinks(); document.getElementById('link-title').value=''; document.getElementById('link-url').value=''; }
        }
        function delLink(i) { if(confirm('åˆªé™¤ï¼Ÿ')){links.splice(i,1); localStorage.setItem('shared_links', JSON.stringify(links)); renderLinks();} }

        // è¨ˆæ™‚å™¨ (é‚è¼¯åŒå‰)
        let tMode='countdown', tVal=300, tInt=null, isRun=false;
        function switchTimerMode(m){tMode=m;resetTimer();document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active'); document.getElementById('preset-area').style.display=m==='countdown'?'grid':'none';}
        function updateTime(s){document.getElementById('timer-text').innerText=`${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;}
        function toggleTimer(){
            const btn=document.getElementById('play-btn');
            if(isRun){clearInterval(tInt);isRun=false;btn.innerText='â–¶';btn.className='control-btn btn-play';}
            else{isRun=true;btn.innerText='â¸';btn.className='control-btn btn-pause';tInt=setInterval(()=>{
                if(tMode==='countdown'){if(tVal>0){tVal--;updateTime(tVal);}else{playBeep();clearInterval(tInt);document.getElementById('timer-text').classList.add('red-alert');}}
                else{tVal++;updateTime(tVal);}
            },1000);}
        }
        function resetTimer(){clearInterval(tInt);isRun=false;tVal=tMode==='countdown'?300:0;updateTime(tVal);document.getElementById('timer-text').classList.remove('red-alert');document.getElementById('play-btn').innerText='â–¶';document.getElementById('play-btn').className='control-btn btn-play';}
        function addTime(s){if(tMode==='countdown'){tVal+=s;updateTime(tVal);}}
        function playBeep(){const A=window.AudioContext||window.webkitAudioContext;if(A){const c=new A(),o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+0.5);}}

        // æ‹–æ›³åŠŸèƒ½
        let zC=100;
        document.querySelectorAll('.widget-window').forEach(w=>{
            const h=w.querySelector('.window-header'); let d=false,x,y,l,t;
            const s=(e)=>{w.style.zIndex=++zC;const p=e.touches?e.touches[0]:e;d=true;x=p.clientX;y=p.clientY;l=w.offsetLeft;t=w.offsetTop;};
            const m=(e)=>{if(!d)return;e.preventDefault();const p=e.touches?e.touches[0]:e;w.style.left=(l+p.clientX-x)+'px';w.style.top=(t+p.clientY-y)+'px';};
            const e=()=>d=false;
            h.addEventListener('mousedown',s);h.addEventListener('touchstart',s,{passive:false});
            document.addEventListener('mousemove',m);document.addEventListener('touchmove',m,{passive:false});
            document.addEventListener('mouseup',e);document.addEventListener('touchend',e);
        });
        function toggleWidget(id){const e=document.getElementById(id);if(e.style.display==='flex')e.style.display='none';else{e.style.display='flex';e.style.zIndex=++zC;}}

        init();
    </script>
</body>
</html>
